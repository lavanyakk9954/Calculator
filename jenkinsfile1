 pipeline{
    agent any
    tools{
        maven "maven"
    }
    stages{
        stage("Fetch code from github repo"){
            steps{
                git url: "https://github.com/lavanyakk9954/Calculator.git"
                echo 'first job done successfully'
            }
        }
stage("This is to build the code"){
            steps{
                sh 'mvn compile'
                echo 'Run Success'
            }
        }
stage("This is to package the code"){
            steps{
                sh 'mvn package'
                echo 'Run Success'
            }
        }
  stage('Build image') {
           steps {
        echo "Building the image"
        sh "sudo docker build -s -t my-image ."
              }
            }
  stage('Push to Docker hub'){
       steps{
           echo "Pushing the image to docker hub"
           withCredentials([usernamePassword(credentialsId: 'dockerHub', passwordVariable: 'dockerHubPass', usernameVariable: 'dockerHubUser')]) {
               sh "sudo docker tag my-image ${env.dockerHubUser}/my-image:latest"
               sh "sudo docker login -u ${env.dockerHubUser} -p ${env.dockerHubPass}"
               sh "sudo docker push ${env.dockerHubUser}/my-image:latest"
            }
         }
       }
    }
}
